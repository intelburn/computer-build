---
- hosts: all
  become: yes
  tasks:
  - name: "Install Updates"
    dnf:
      name: "*"
      state: latest
  - name: "Reboot"
    reboot:
  - name: "Install Cockpit"
    dnf:
      name:
        - cockpit
        - cockpit-storaged
        - cockpit-storaged
      state: latest
  - name: "Install Nvidia Dependencies"
    dnf:
      name:
        - kernel-devel
        - kernel-headers
        - gcc
        - make
        - dkms
        - acpid
        - libglvnd-glx
        - libglvnd-opengl
        - libglvnd-devel
        - pkgconfig
      state: latest
  - name: "Install Nvidia"
     dnf:
      name:
        - akmod-nvidia
        - xorg-x11-drv-nvidia-cuda
      state: latest
  - name: "Install Updates"
    dnf:
      name: "*"
      state: latest
    dnf:
  - name: "VSCode"
      name: https://code.visualstudio.com/sha/download?build=stable&os=linux-rpm-x64 
      state: present
  - name: "Install Resilio"
    dnf:
      # Update this with a new link from https://help.resilio.com/hc/en-us/articles/206178924-Installing-Sync-package-on-Linux
      name: https://download-cdn.resilio.com/2.6.3/RPM/resilio-sync-2.6.3-1.x86_64.rpm
      state: present
  - name: "Change Resilio Unit file"
    lineinfile:
      path: /usr/lib/systemd/user/resilio-sync.service 
      regex: '^WantedBy=multi-user\.target'
      line: 'WantedBy=default.target'
  - name: "Disable and stop Resilio from running as a system daemon"
    script: ./resilio-disable.sh
  - name: "Add VirtualBox Repo"
    yum_repository:
      name: "VirtualBox"
      baseurl: "http://download.virtualbox.org/virtualbox/rpm/fedora/$releasever/$basearch"
      gpgkey: "https://www.virtualbox.org/download/oracle_vbox_2016.asc"
  - name
  - name: "Add Current user to vboxusers group"
    user:
      # change user to match your configuration
      name: n00b
      groups: vboxusers
      append: yes
  - name: "Install vbox extpack"
    script: ./install-vbox-extpack.sh 6.0.14
  - name: "Install Ansible"
    dnf:
      name:
        - ansible
        - ansible-lint
        - ansible-doc
  - name: "Intall Discord"
    snap:
      name: discord
  - name: "Install Keybase"
    dnf:
      name: https://prerelease.keybase.io/keybase_amd64.rpm
      state: present
  - name: "Final Update check"
    dnf:
      name: "*"
      state: latest
  - name: "Final Reboot"
    reboot:
